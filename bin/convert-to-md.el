(require 'package)
(let* ((no-ssl (and (memq system-type '(windows-nt ms-dos))
                    (not (gnutls-available-p))))
       (proto (if no-ssl "http" "https")))
  (add-to-list 'package-archives (cons "melpa" (concat proto "://melpa.org/packages/")) t))

(package-initialize)

(package-install 'ox-gfm)
(package-install 'org-make-toc)
(require 'ox-gfm)
(require 'org-make-toc)

(setq org-export-use-babel nil)
(print command-line-args)
(let ((org-file (car (last command-line-args)))
      (org-make-toc-insert-custom-ids t))
  (find-file org-file)
  (beginning-of-buffer)
  (insert "#+OPTIONS: toc:nil broken-links:t\n")
  (when (member "create-toc" command-line-args)
    (save-mark-and-excursion
      (set-mark (point-min))
      (goto-char (point-max))
      (org-map-region #'org-demote (region-beginning) (region-end)))
    (insert "* Years")
    (insert "\n:PROPERTIES:\n:TOC:      :include all :depth 1\n:END:\n\n:CONTENTS:\n\n:END:")
    (org-make-toc)
    (save-buffer))
  (org-gfm-export-to-markdown))
